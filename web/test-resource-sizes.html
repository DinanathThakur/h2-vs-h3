<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resource Sizes Test - Varying File Sizes</title>
    <link rel="stylesheet" href="resources/css/small.css">
    <link rel="stylesheet" href="resources/css/medium.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-content {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .resource-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }
        .resource-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 1rem;
            background: #fafafa;
        }
        .resource-status {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ccc;
        }
        .status-loading {
            background: #ffc107;
            animation: pulse 1s infinite;
        }
        .status-loaded {
            background: #28a745;
        }
        .status-error {
            background: #dc3545;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        .stats {
            background: #e7f3ff;
            padding: 1rem;
            border-radius: 4px;
            margin: 1rem 0;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 1rem 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #007bff, #0056b3);
            width: 0%;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="test-content">
        <h1>Resource Size Comparison Test</h1>
        <p>This test loads CSS and JavaScript files of varying sizes to demonstrate how different protocols handle resources of different sizes.</p>
        
        <div class="stats">
            <h3>Loading Progress</h3>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <p><strong>Protocol:</strong> <span id="protocol">Detecting...</span></p>
            <p><strong>Resources Loaded:</strong> <span id="loadedCount">0</span> / <span id="totalCount">6</span></p>
            <p><strong>Total Load Time:</strong> <span id="totalLoadTime">Measuring...</span></p>
            <p><strong>Total Size:</strong> <span id="totalSize">~21KB</span></p>
        </div>

        <div class="resource-grid" id="resourceGrid">
            <!-- Resource cards will be generated here -->
        </div>

        <h2>Resource Size Impact</h2>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin: 2rem 0;">
            <div>
                <h3>Small Resources (1KB)</h3>
                <ul>
                    <li>Quick to transfer</li>
                    <li>Connection overhead more significant</li>
                    <li>Benefits from multiplexing</li>
                    <li>Good for critical path resources</li>
                </ul>
            </div>
            <div>
                <h3>Large Resources (15KB+)</h3>
                <ul>
                    <li>Transfer time dominates</li>
                    <li>Connection overhead less significant</li>
                    <li>Benefits from compression</li>
                    <li>May benefit from streaming</li>
                </ul>
            </div>
        </div>

        <div class="resource-card">
            <h3>Test Results Analysis</h3>
            <div id="analysisResults">
                <p>Load all resources to see analysis...</p>
            </div>
        </div>
    </div>

    <script>
        const resources = [
            { name: 'Small CSS', url: 'resources/css/small.css', type: 'css', size: '~1KB' },
            { name: 'Medium CSS', url: 'resources/css/medium.css', type: 'css', size: '~5KB' },
            { name: 'Large CSS', url: 'resources/css/large.css', type: 'css', size: '~15KB' },
            { name: 'Small JS', url: 'resources/js/small.js', type: 'js', size: '~1KB' },
            { name: 'Medium JS', url: 'resources/js/medium.js', type: 'js', size: '~5KB' },
            { name: 'Large JS', url: 'resources/js/large.js', type: 'js', size: '~15KB' }
        ];

        let loadedCount = 0;
        let loadTimes = [];
        let startTime = performance.now();

        function detectProtocol() {
            const protocol = location.protocol === 'https:' ? 'HTTPS' : 'HTTP';
            document.getElementById('protocol').textContent = protocol;
        }

        function createResourceCards() {
            const grid = document.getElementById('resourceGrid');
            
            resources.forEach((resource, index) => {
                const card = document.createElement('div');
                card.className = 'resource-card';
                card.innerHTML = `
                    <div class="resource-status">
                        <strong>${resource.name}</strong>
                        <div class="status-indicator status-loading" id="status-${index}"></div>
                    </div>
                    <p><strong>Type:</strong> ${resource.type.toUpperCase()}</p>
                    <p><strong>Size:</strong> ${resource.size}</p>
                    <p><strong>Load Time:</strong> <span id="time-${index}">Loading...</span></p>
                    <p><strong>URL:</strong> <code>${resource.url}</code></p>
                `;
                grid.appendChild(card);
                
                // Start loading resource
                loadResource(resource, index);
            });
        }

        function loadResource(resource, index) {
            const startTime = performance.now();
            
            if (resource.type === 'css') {
                loadCSS(resource.url, startTime, index);
            } else if (resource.type === 'js') {
                loadJS(resource.url, startTime, index);
            }
        }

        function loadCSS(url, startTime, index) {
            const link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = url + '?t=' + Date.now(); // Cache busting
            
            link.onload = function() {
                onResourceLoaded(startTime, index);
            };
            
            link.onerror = function() {
                onResourceError(index);
            };
            
            document.head.appendChild(link);
        }

        function loadJS(url, startTime, index) {
            const script = document.createElement('script');
            script.src = url + '?t=' + Date.now(); // Cache busting
            
            script.onload = function() {
                onResourceLoaded(startTime, index);
            };
            
            script.onerror = function() {
                onResourceError(index);
            };
            
            document.head.appendChild(script);
        }

        function onResourceLoaded(startTime, index) {
            const loadTime = performance.now() - startTime;
            loadTimes.push({ index, loadTime, resource: resources[index] });
            loadedCount++;
            
            document.getElementById(`status-${index}`).className = 'status-indicator status-loaded';
            document.getElementById(`time-${index}`).textContent = Math.round(loadTime) + 'ms';
            
            updateProgress();
            
            if (loadedCount === resources.length) {
                onAllResourcesLoaded();
            }
        }

        function onResourceError(index) {
            loadedCount++;
            document.getElementById(`status-${index}`).className = 'status-indicator status-error';
            document.getElementById(`time-${index}`).textContent = 'Error';
            
            updateProgress();
        }

        function updateProgress() {
            const progress = (loadedCount / resources.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('loadedCount').textContent = loadedCount;
        }

        function onAllResourcesLoaded() {
            const totalTime = performance.now() - startTime;
            document.getElementById('totalLoadTime').textContent = Math.round(totalTime) + 'ms';
            
            generateAnalysis();
            
            // Signal completion to parent frame
            if (window.parent !== window) {
                window.parent.postMessage({
                    type: 'pageLoaded',
                    testType: 'resource-sizes',
                    loadTime: totalTime,
                    resourceCount: resources.length,
                    resourceDetails: loadTimes,
                    url: location.href
                }, '*');
            }
        }

        function generateAnalysis() {
            const smallResources = loadTimes.filter(r => r.resource.size.includes('1KB'));
            const mediumResources = loadTimes.filter(r => r.resource.size.includes('5KB'));
            const largeResources = loadTimes.filter(r => r.resource.size.includes('15KB'));
            
            const avgSmall = smallResources.reduce((sum, r) => sum + r.loadTime, 0) / smallResources.length;
            const avgMedium = mediumResources.reduce((sum, r) => sum + r.loadTime, 0) / mediumResources.length;
            const avgLarge = largeResources.reduce((sum, r) => sum + r.loadTime, 0) / largeResources.length;
            
            const analysis = `
                <h4>Performance Analysis</h4>
                <p><strong>Small Resources (1KB):</strong> Average ${Math.round(avgSmall)}ms</p>
                <p><strong>Medium Resources (5KB):</strong> Average ${Math.round(avgMedium)}ms</p>
                <p><strong>Large Resources (15KB):</strong> Average ${Math.round(avgLarge)}ms</p>
                <p><strong>Size vs Time Ratio:</strong> ${(avgLarge / avgSmall).toFixed(2)}x slower for 15x larger files</p>
                <p><strong>Efficiency:</strong> ${avgLarge < (avgSmall * 15) ? 'Good' : 'Poor'} - Protocol handles larger files efficiently</p>
            `;
            
            document.getElementById('analysisResults').innerHTML = analysis;
        }

        // Initialize when page loads
        window.addEventListener('load', function() {
            detectProtocol();
            createResourceCards();
        });
    </script>
</body>
</html>